[global]
; Error log to stderr for Cloud Run logging
error_log = /dev/stderr
log_level = warning

; Daemonize is handled by supervisor
daemonize = no

[www]
; User/group for the worker processes
user = www-data
group = www-data

; Listen on TCP port for nginx connection
listen = 127.0.0.1:9000
listen.owner = www-data
listen.group = www-data
listen.mode = 0660

; Process manager configuration optimized for Cloud Run (1 CPU, 1GB RAM)
; Using 'ondemand' to spawn workers only when needed, reducing idle resource usage
pm = ondemand

; Maximum number of child processes
; With 256MB per process and 1GB container, limit to 3 to leave room for nginx/system
pm.max_children = 3

; Number of seconds after which an idle process will be killed
pm.process_idle_timeout = 10s

; Maximum number of requests each child process should execute before respawning
; Helps prevent memory leaks from causing issues
pm.max_requests = 500

; Logging
access.log = /dev/stderr
access.format = "%R - %u %t \"%m %r%Q%q\" %s %f %{mili}d %{kilo}M %C%%"

; Slow log for debugging performance issues
slowlog = /dev/stderr
request_slowlog_timeout = 60s

; Terminate request if it takes too long (prevents hung processes)
request_terminate_timeout = 600s

; Clear environment for security
clear_env = no

; Catch worker output for logging
catch_workers_output = yes
decorate_workers_output = no

; PHP settings overrides for this pool
php_admin_value[error_log] = /dev/stderr
php_admin_flag[log_errors] = on
php_admin_value[memory_limit] = 256M
php_admin_value[max_execution_time] = 600
